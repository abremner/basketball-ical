<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Waverley Basketball Fixtures</title>
  <style>
    body { font-family: sans-serif; padding: 2rem; background: #f9f9f9; }
    h1 { color: #333; }
    label, select { display: block; margin-top: 1rem; }
    #calendar-link { margin-top: 2rem; display: none; }
    .btn {
      display: inline-block;
      margin-top: 1rem;
      padding: 0.5rem 1rem;
      background: #007acc;
      color: white;
      text-decoration: none;
      border-radius: 4px;
    }
    .btn:hover { background: #005fa3; }
  </style>
</head>
<body>
  <h1>Waverley Basketball Fixture Calendars</h1>
  <p>Select your team to subscribe to their calendar:</p>

  <label for="ageGroup">Age Group:</label>
  <select id="ageGroup"><option value="">Select Age Group</option></select>

  <label for="division">Division:</label>
  <select id="division"><option value="">Select Division</option></select>

  <label for="team">Team:</label>
  <select id="team"><option value="">Select Team</option></select>

  <div id="calendar-link">
    <p><a id="icsLink" class="btn" href="#" target="_blank">üìÖ Subscribe</a></p>
    <p><a id="icsDownload" class="btn" href="#" download>‚¨áÔ∏è Download Calendar</a></p>
  </div>

  <script>
    const data = DATA_PLACEHOLDER;

    const ageGroupSelect = document.getElementById('ageGroup');
    const divisionSelect = document.getElementById('division');
    const teamSelect = document.getElementById('team');
    const linkContainer = document.getElementById('calendar-link');
    const icsLink = document.getElementById('icsLink');
    const icsDownload = document.getElementById('icsDownload');

    function clearSelect(select) {
      select.innerHTML = '<option value="">Select</option>';
    }

    function populateSelect(select, options) {
      clearSelect(select);
      options.forEach(opt => {
        const o = document.createElement('option');
        o.value = opt;
        o.textContent = opt;
        select.appendChild(o);
      });
    }

    function sortAgeGroups(groups) {
      return groups.sort((a, b) => {
        const ageA = parseInt(a.match(/\\d+/));
        const ageB = parseInt(b.match(/\\d+/));
        return ageA - ageB;
      });
    }

    function sortAlpha(arr) {
      return arr.sort((a, b) => a.localeCompare(b));
    }

    ageGroupSelect.addEventListener('change', () => {
      clearSelect(divisionSelect);
      clearSelect(teamSelect);
      linkContainer.style.display = 'none';
      const divisions = Object.keys(data[ageGroupSelect.value] || {});
      populateSelect(divisionSelect, sortAlpha(divisions));
    });

    divisionSelect.addEventListener('change', () => {
      clearSelect(teamSelect);
      linkContainer.style.display = 'none';
      const teams = Object.keys(data[ageGroupSelect.value]?.[divisionSelect.value] || {});
      populateSelect(teamSelect, sortAlpha(teams));
    });

    teamSelect.addEventListener('change', () => {
      const age = ageGroupSelect.value;
      const div = divisionSelect.value;
      const team = teamSelect.value;
      const link = data[age]?.[div]?.[team];
      if (link) {
        icsLink.href = link;
        icsLink.textContent = `üìÖ ${team} Calendar`;
        icsDownload.href = link;
        icsDownload.download = `${team}.ics`;
        linkContainer.style.display = 'block';
      } else {
        linkContainer.style.display = 'none';
      }
    });

    window.onload = () => {
      const ageGroups = Object.keys(data);
      populateSelect(ageGroupSelect, sortAgeGroups(ageGroups));
    };
  </script>
</body>
</html>
